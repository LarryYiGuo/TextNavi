# 📱 移动设备访问测试指南

## 🎯 问题描述

PC可以正常访问，但手机无法打开Web应用。

## 🔍 问题分析

### **常见原因**
1. **HTTPS证书问题**: 移动浏览器对自签名证书更严格
2. **网络隔离**: UCL eduroam可能隔离设备间通信
3. **端口阻塞**: 某些端口可能被网络策略阻止
4. **防火墙限制**: 移动设备或网络防火墙限制

## 🚀 解决方案

### **方案1: 使用HTTP模式（推荐）**

#### **步骤1: 停止当前服务**
```bash
# 停止当前运行的服务
lsof -ti :8001 | xargs kill -9
lsof -ti :5173 | xargs kill -9
```

#### **步骤2: 使用移动设备启动脚本**
```bash
chmod +x start_mobile.sh
./start_mobile.sh
```

选择选项3启动完整系统（HTTP模式）

#### **步骤3: 在手机上访问**
- **前端**: http://10.23.105.156:5173
- **后端**: http://10.23.105.156:8001/health

### **方案2: 手动启动HTTP模式**

#### **启动后端**
```bash
cd backend
source ../.venv/bin/activate
uvicorn app:app --reload --host 0.0.0.0 --port 8001
```

#### **启动前端（HTTP模式）**
```bash
cd frontend
npm run dev:http
```

### **方案3: 修改现有配置**

#### **临时修改vite.config.js**
```javascript
export default defineConfig({
  plugins: [react()], // 移除 mkcert
  server: {
    host: '0.0.0.0',
    https: false, // 改为false
    // ... 其他配置
  }
})
```

## 📱 移动设备测试步骤

### **1. 网络连接检查**
- 确保手机和PC连接到同一个UCL eduroam网络
- 检查手机是否显示相同的网络名称

### **2. 浏览器测试**
- 尝试不同的移动浏览器：
  - Chrome Mobile
  - Safari Mobile
  - Firefox Mobile
- 在地址栏输入：`http://10.23.105.156:5173`

### **3. 网络诊断**
- 在手机浏览器中访问：`http://10.23.105.156:8001/health`
- 如果显示JSON响应，说明后端可访问
- 如果显示错误，说明网络连接有问题

## 🔧 故障排除

### **如果仍然无法访问**

#### **检查1: 网络策略**
```bash
# 测试端口是否被阻止
telnet 10.23.105.156 8001
telnet 10.23.105.156 5173
```

#### **检查2: 防火墙设置**
```bash
# 检查macOS防火墙
sudo pfctl -s all
```

#### **检查3: 网络接口**
```bash
# 确认服务绑定到正确接口
netstat -an | grep "8001\|5173"
```

### **替代方案**

#### **使用不同端口**
如果8001和5173被阻止，尝试其他端口：
```bash
# 后端使用8080端口
uvicorn app:app --reload --host 0.0.0.0 --port 8080

# 前端使用3000端口
npm run dev -- --port 3000
```

#### **使用ngrok隧道**
如果网络限制太严格，可以使用ngrok：
```bash
# 安装ngrok
brew install ngrok

# 创建隧道
ngrok http 8001  # 后端
ngrok http 5173  # 前端
```

## 📊 测试结果记录

### **成功指标**
- [ ] 手机可以访问前端页面
- [ ] 手机可以调用后端API
- [ ] 拍照功能正常工作
- [ ] 导航功能正常

### **失败时的信息收集**
- 错误信息截图
- 浏览器控制台日志
- 网络请求状态
- 设备型号和系统版本

## 🎯 预期结果

使用HTTP模式后，手机应该能够：
1. 正常加载前端页面
2. 访问后端API接口
3. 使用所有功能（拍照、导航等）
4. 避免SSL证书问题

## 📞 获取帮助

如果问题仍然存在，请提供：
1. 具体的错误信息
2. 手机型号和系统版本
3. 浏览器类型和版本
4. 网络连接状态截图

---

**注意**: HTTP模式仅用于测试，生产环境建议使用HTTPS。
