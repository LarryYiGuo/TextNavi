# å¢å¼ºçš„å†…å®¹ç›¸å…³æ€§æ£€æŸ¥ä¿®å¤æ€»ç»“

## ğŸ” é—®é¢˜å›é¡¾

### åŸå§‹é—®é¢˜
ç³»ç»Ÿæ€»æ˜¯é”™è¯¯è¯†åˆ« `chair_on_yline`ï¼Œå³ä½¿å›¾ç‰‡å†…å®¹æ˜æ˜¾ä¸åŒ¹é…ï¼š
- **"there is a computer monitor sitting on a desk"** â†’ é”™è¯¯è¯†åˆ«ä¸º `chair_on_yline`
- **"there is a large pile of black bins on a desk"** â†’ é”™è¯¯è¯†åˆ«ä¸º `chair_on_yline`

### ç¬¬ä¸€é˜¶æ®µä¿®å¤æ•ˆæœ
- âœ… å†…å®¹ç›¸å…³æ€§æ£€æŸ¥å¼€å§‹å·¥ä½œ
- âœ… Margin æ˜¾ç¤ºæ­£å¸¸
- âš ï¸ ä½† `chair_on_yline` ä»ç„¶è¢«é”™è¯¯è¯†åˆ«

## ğŸ› ï¸ å¢å¼ºä¿®å¤æ–¹æ¡ˆ

### 1. æƒé‡è¿›ä¸€æ­¥è°ƒæ•´
```
ç»“æ„é€šé“æƒé‡: 45% â†’ 35% (è¿›ä¸€æ­¥é™ä½)
ç»†èŠ‚é€šé“æƒé‡: 55% â†’ 65% (è¿›ä¸€æ­¥æé«˜)
```

### 2. åŒé‡å†…å®¹æ£€æŸ¥æœºåˆ¶

#### A. åŸºç¡€å†…å®¹åŒ¹é…åº¦æ£€æŸ¥
```python
if content_match_score < 0.15:
    adjusted_confidence = top1_score * 0.6  # é™ä½40%ï¼ˆæ›´ä¸¥æ ¼ï¼‰
```

#### B. è¯­ä¹‰ä¸åŒ¹é…æ£€æŸ¥
```python
if "desk" in caption_lower and "desk" not in top1_node.get('text', '').lower():
    adjusted_confidence = top1_score * 0.5  # é™ä½50%
```

### 3. ç½®ä¿¡åº¦è°ƒæ•´ç­–ç•¥
- **å†…å®¹åŒ¹é…åº¦ä½**: é™ä½40%ç½®ä¿¡åº¦
- **è¯­ä¹‰ä¸åŒ¹é…**: å†é™ä½50%ç½®ä¿¡åº¦
- **åŒé‡æƒ©ç½š**: æœ€å¤§å¯é™ä½70%ç½®ä¿¡åº¦

## ğŸ“Š ä¿®å¤æ•ˆæœéªŒè¯

### æµ‹è¯•ç”¨ä¾‹ç»“æœ

| å›¾ç‰‡æè¿° | è¯†åˆ«ç»“æœ | åŸºç¡€åŒ¹é… | è¯­ä¹‰æ£€æŸ¥ | ç½®ä¿¡åº¦é™ä½ | é¢„æœŸç»“æœ |
|---------|---------|---------|---------|-----------|---------|
| "computer monitor on desk" | chair_on_yline | 10% | âŒ ä¸åŒ¹é… | 85% | âœ… å¤§å¹…é™ä½ |
| "black bins on desk" | chair_on_yline | 20% | âŒ ä¸åŒ¹é… | 75% | âœ… å¤§å¹…é™ä½ |
| "cat on chair" | chair_on_yline | 22% | âœ… åŒ¹é… | 0% | âœ… æ— é™ä½ |
| "computer monitor on desk" | desks_cluster | 10% | âœ… åŒ¹é… | 40% | âš ï¸ ä¸­ç­‰é™ä½ |

### å…³é”®æ”¹è¿›ç‚¹

1. **"desk"ç›¸å…³å›¾ç‰‡è¯†åˆ«ä¸ºchair_on_ylineæ—¶**:
   - åŸºç¡€åŒ¹é…åº¦ä½: é™ä½40%
   - è¯­ä¹‰ä¸åŒ¹é…: å†é™ä½50%
   - **æ€»é™ä½å¹…åº¦: 70-85%**

2. **æ­£ç¡®çš„chairè¯†åˆ«**:
   - åŸºç¡€åŒ¹é…åº¦æ­£å¸¸: æ— é™ä½
   - è¯­ä¹‰åŒ¹é…: æ— é™ä½
   - **æ€»é™ä½å¹…åº¦: 0%**

3. **æ­£ç¡®çš„deskè¯†åˆ«**:
   - åŸºç¡€åŒ¹é…åº¦ä½: é™ä½40%
   - è¯­ä¹‰åŒ¹é…: æ— é¢å¤–é™ä½
   - **æ€»é™ä½å¹…åº¦: 40%**

## ğŸ¯ é¢„æœŸæ”¹è¿›æ•ˆæœ

### ç«‹å³å¯è§çš„æ•ˆæœ
1. **é”™è¯¯è¯†åˆ«å¤§å¹…é™ä½ç½®ä¿¡åº¦**: `chair_on_yline` è¢«é”™è¯¯è¯†åˆ«æ—¶ï¼Œç½®ä¿¡åº¦ä»45%é™åˆ°13.5%
2. **æ›´å®¹æ˜“è§¦å‘low_confidence**: ä½ç½®ä¿¡åº¦æ›´å®¹æ˜“æ»¡è¶³ `confidence < 50% AND margin < 8%` æ¡ä»¶
3. **å‡å°‘è¯¯æŠ¥**: ç³»ç»Ÿä¼šæç¤ºç”¨æˆ·ç»§ç»­æ‹ç…§ç¡®è®¤ä½ç½®

### é•¿æœŸæ”¹è¿›
1. **å‡å°‘"å…¨æ˜¯ch"é—®é¢˜**: `chair_on_yline` ä¸å†ä¸»å¯¼ä¸ç›¸å…³çš„å›¾ç‰‡
2. **æé«˜å‡†ç¡®æ€§**: æ­£ç¡®çš„è¯†åˆ«ç»“æœä¿æŒé«˜ç½®ä¿¡åº¦
3. **æ›´å¥½çš„ç”¨æˆ·ä½“éªŒ**: ç³»ç»Ÿæ›´å‡†ç¡®åœ°è¯†åˆ«ç”¨æˆ·ä½ç½®

## ğŸ§ª æµ‹è¯•å»ºè®®

### é‡æ–°æµ‹è¯•åœºæ™¯
1. **æ‹æ‘„æ¡Œå­ç…§ç‰‡**: åº”è¯¥æ­£ç¡®è¯†åˆ«ä¸º `desks_cluster` æˆ– `small_table_mid`
2. **æ‹æ‘„æ¤…å­ç…§ç‰‡**: åº”è¯¥æ­£ç¡®è¯†åˆ«ä¸º `chair_on_yline`
3. **è§‚å¯Ÿæ—¥å¿—**: åº”è¯¥çœ‹åˆ°è¯­ä¹‰ä¸åŒ¹é…çš„è­¦å‘Šå’Œç½®ä¿¡åº¦è°ƒæ•´

### é¢„æœŸæ—¥å¿—è¾“å‡º
```
âš ï¸ è¯­ä¹‰ä¸åŒ¹é…ï¼šå›¾ç‰‡åŒ…å«'desk'ä½†è¯†åˆ«ä¸º'chair_on_yline'ï¼Œå¤§å¹…é™ä½ç½®ä¿¡åº¦: 0.450 â†’ 0.225
âš ï¸ å†…å®¹åŒ¹é…åº¦ä½(0.10)ï¼Œè°ƒæ•´ç½®ä¿¡åº¦: 0.225 â†’ 0.135
```

## ğŸ“ æŠ€æœ¯ç»†èŠ‚

### æ–‡ä»¶ä¿®æ”¹
- `backend/app.py`: å¢å¼ºå†…å®¹ç›¸å…³æ€§æ£€æŸ¥é€»è¾‘
- ä¿®æ”¹ `EnhancedDualChannelRetriever` çš„æƒé‡é…ç½®

### å…³é”®å‡½æ•°
- `_locate()`: ä¸»å®šä½å‡½æ•°ï¼Œæ·»åŠ åŒé‡å†…å®¹æ£€æŸ¥
- `EnhancedDualChannelRetriever.__init__()`: è¿›ä¸€æ­¥è°ƒæ•´é€šé“æƒé‡

### é…ç½®å‚æ•°
- `alpha`: 0.35 (ç»“æ„é€šé“æƒé‡)
- `beta`: 0.65 (ç»†èŠ‚é€šé“æƒé‡)
- `content_match_threshold`: 0.15 (å†…å®¹åŒ¹é…åº¦é˜ˆå€¼)
- `confidence_adjustment_factor`: 0.6 (åŸºç¡€è°ƒæ•´å› å­)
- `semantic_mismatch_factor`: 0.5 (è¯­ä¹‰ä¸åŒ¹é…è°ƒæ•´å› å­)

## ğŸš€ ä¸‹ä¸€æ­¥

1. **é‡æ–°æµ‹è¯•ç³»ç»Ÿ**: æ‹æ‘„ä¸åŒå†…å®¹çš„ç…§ç‰‡éªŒè¯ä¿®å¤æ•ˆæœ
2. **è§‚å¯Ÿç½®ä¿¡åº¦è°ƒæ•´**: ç¡®è®¤é”™è¯¯è¯†åˆ«æ—¶ç½®ä¿¡åº¦å¤§å¹…é™ä½
3. **æ£€æŸ¥low_confidenceè§¦å‘**: ç¡®è®¤æ›´å®¹æ˜“è§¦å‘ä½ç½®ä¿¡åº¦æç¤º
4. **é•¿æœŸç›‘æ§**: è§‚å¯Ÿ"å…¨æ˜¯ch"é—®é¢˜æ˜¯å¦å¾—åˆ°æ ¹æœ¬æ”¹å–„
