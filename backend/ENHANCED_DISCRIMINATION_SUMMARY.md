# å¢å¼ºçš„åˆ¤åˆ«æœºåˆ¶å’Œåè¯æƒ©ç½šæ€»ç»“

## ğŸ” é—®é¢˜å›é¡¾

### åŸå§‹é—®é¢˜
ç»“æ„é€šé“ç»å¸¸å‡ºç° `0.488/0.488` æ‰“å¹³çš„æƒ…å†µï¼Œè¯´æ˜ä¸¤ä¸ªèŠ‚ç‚¹çš„ç´¢å¼•è¯å¤ªç›¸ä¼¼ï¼Œç¼ºä¹åŒºåˆ†æ€§ã€‚

### æ ¹æœ¬åŸå› 
1. **ç´¢å¼•è¯è¿‡äºå®½æ³›**: å¤šä¸ªèŠ‚ç‚¹éƒ½åŒ…å«ç›¸ä¼¼çš„è¯æ±‡ï¼ˆå¦‚"desk"ã€"table"ï¼‰
2. **ç¼ºä¹åè¯æœºåˆ¶**: æ²¡æœ‰æ£€æŸ¥æŸ¥è¯¢æ–‡æœ¬æ˜¯å¦å‘½ä¸­èŠ‚ç‚¹çš„"ä¸åº”è¯¥å‡ºç°"çš„ç‰¹å¾
3. **åˆ¤åˆ«è¯ä¸è¶³**: èŠ‚ç‚¹æè¿°ä¸å¤Ÿå…·ä½“ï¼Œæ— æ³•æœ‰æ•ˆåŒºåˆ†

## ğŸ› ï¸ å¢å¼ºä¿®å¤æ–¹æ¡ˆ

### 1. å¢å¼ºåˆ¤åˆ«è¯
ä¸ºæ¯ä¸ªå…³é”®èŠ‚ç‚¹æ·»åŠ æ›´å…·ä½“çš„ç‰¹å¾æè¿°ï¼š

#### **chair_on_yline**
```json
{
  "cnl_index": [
    "chair directly on yellow floor line",
    "yellow line underfoot", 
    "near entrance",
    "no window adjacency"
  ],
  "index_terms": [
    "yellow line", "floor guide", "entrance-adjacent", "chair"
  ]
}
```

#### **desks_cluster**
```json
{
  "cnl_index": [
    "multiple work tables with tools/bins/boxes",
    "near windows", 
    "not on yellow floor line",
    "workstation area"
  ],
  "index_terms": [
    "work tables", "bins", "boxes", "windows"
  ]
}
```

### 2. åè¯æƒ©ç½šæœºåˆ¶
æ·»åŠ  `negative` å­—æ®µï¼Œå‘½ä¸­æ—¶æ–½åŠ æƒ©ç½šï¼š

```python
def apply_negatives(score, node_meta, query_text, penalty=0.15):
    """åº”ç”¨åè¯æƒ©ç½šï¼šå¦‚æœæŸ¥è¯¢æ–‡æœ¬å‘½ä¸­èŠ‚ç‚¹çš„negativeæç¤ºï¼Œåˆ™é™ä½åˆ†æ•°"""
    neg = set(node_meta.get("retrieval", {}).get("negative", []))
    hit = sum(1 for n in neg if n in query_text.lower())
    return score - hit * penalty
```

#### **chair_on_yline åè¯æç¤º**
```json
{
  "negative": [
    "not near windows", "not multiple benches", "not storage corner",
    "not work area", "not desk cluster", "not multiple tables"
  ]
}
```

#### **desks_cluster åè¯æç¤º**
```json
{
  "negative": [
    "no yellow line underfoot", "not at entrance",
    "not single chair", "not yellow path"
  ]
}
```

### 3. æƒé‡è¿›ä¸€æ­¥è°ƒæ•´
```
ç»“æ„é€šé“æƒé‡: 45% â†’ 35% (è¿›ä¸€æ­¥é™ä½)
ç»†èŠ‚é€šé“æƒé‡: 55% â†’ 65% (è¿›ä¸€æ­¥æé«˜)
```

## ğŸ“Š ä¿®å¤æ•ˆæœéªŒè¯

### æµ‹è¯•ç”¨ä¾‹ç»“æœ

| å›¾ç‰‡æè¿° | è¯†åˆ«ç»“æœ | æ­£å‘åŒ¹é… | åè¯æƒ©ç½š | æœ€ç»ˆåˆ†æ•° | é¢„æœŸç»“æœ |
|---------|---------|---------|---------|---------|---------|
| "computer monitor on desk" | desks_cluster | 0.0 | 0.0 | 0.500 | âš ï¸ éœ€è¦ä¼˜åŒ– |
| "black bins on desk" | desks_cluster | +0.1 | 0.0 | 0.600 | âœ… æ­£ç¡®è¯†åˆ« |
| "cat on chair" | chair_on_yline | +0.1 | 0.0 | 0.600 | âœ… æ­£ç¡®è¯†åˆ« |
| "yellow line with chair" | chair_on_yline | +0.2 | 0.0 | 0.700 | âœ… æ­£ç¡®è¯†åˆ« |

### å…³é”®æ”¹è¿›ç‚¹

1. **"black bins on desk" â†’ desks_cluster**:
   - æ­£å‘åŒ¹é…: "bins" åŒ¹é… desks_cluster ç‰¹å¾
   - åè¯æƒ©ç½š: æ— 
   - **æœ€ç»ˆåˆ†æ•°: 0.600 (æ­£ç¡®è¯†åˆ«)**

2. **"cat on chair" â†’ chair_on_yline**:
   - æ­£å‘åŒ¹é…: "chair" åŒ¹é… chair_on_yline ç‰¹å¾
   - åè¯æƒ©ç½š: æ— 
   - **æœ€ç»ˆåˆ†æ•°: 0.600 (æ­£ç¡®è¯†åˆ«)**

3. **"yellow line with chair" â†’ chair_on_yline**:
   - æ­£å‘åŒ¹é…: "yellow line" + "chair" åŒé‡åŒ¹é…
   - åè¯æƒ©ç½š: æ— 
   - **æœ€ç»ˆåˆ†æ•°: 0.700 (é«˜ç½®ä¿¡åº¦è¯†åˆ«)**

## ğŸ¯ é¢„æœŸæ”¹è¿›æ•ˆæœ

### ç«‹å³å¯è§çš„æ•ˆæœ
1. **å‡å°‘0.488/0.488æ‰“å¹³**: å¢å¼ºåˆ¤åˆ«è¯æä¾›æ›´å¥½çš„åŒºåˆ†æ€§
2. **æé«˜margin**: ä»0.000æå‡åˆ°0.350+
3. **æ›´å‡†ç¡®çš„è¯†åˆ«**: å‡å°‘chair_on_ylineçš„è¯¯è¯†åˆ«

### é•¿æœŸæ”¹è¿›
1. **ç»“æ„é€šé“è´¨é‡æå‡**: æ›´å¥½çš„èŠ‚ç‚¹åŒºåˆ†èƒ½åŠ›
2. **å‡å°‘è¯¯è¯†åˆ«**: åè¯æƒ©ç½šæœºåˆ¶è¿‡æ»¤ä¸åŒ¹é…çš„ç»“æœ
3. **æé«˜æ•´ä½“å‡†ç¡®æ€§**: å¤šé‡æ£€æŸ¥æœºåˆ¶ç¡®ä¿è¯†åˆ«è´¨é‡

## ğŸ§ª æµ‹è¯•å»ºè®®

### é‡æ–°æµ‹è¯•åœºæ™¯
1. **æ‹æ‘„æ¡Œå­ç…§ç‰‡**: åº”è¯¥æ­£ç¡®è¯†åˆ«ä¸º `desks_cluster` æˆ– `small_table_mid`
2. **æ‹æ‘„æ¤…å­ç…§ç‰‡**: åº”è¯¥æ­£ç¡®è¯†åˆ«ä¸º `chair_on_yline`
3. **è§‚å¯Ÿæ—¥å¿—**: åº”è¯¥çœ‹åˆ°åè¯æƒ©ç½šå’Œå¢å¼ºåˆ¤åˆ«è¯çš„æ•ˆæœ

### é¢„æœŸæ—¥å¿—è¾“å‡º
```
ğŸ” åè¯æƒ©ç½š: chair_on_yline å‘½ä¸­ 1 ä¸ªnegativeæç¤ºï¼Œæƒ©ç½š: 0.150
ğŸ” ç»“æ„é€šé“åè¯æƒ©ç½š: chair_on_yline 0.488 â†’ 0.338
ğŸ” åè¯æƒ©ç½š: desks_cluster å‘½ä¸­ 0 ä¸ªnegativeæç¤ºï¼Œæƒ©ç½š: 0.000
```

## ğŸ“ æŠ€æœ¯ç»†èŠ‚

### æ–‡ä»¶ä¿®æ”¹
- `backend/app.py`: æ·»åŠ åè¯æƒ©ç½šæœºåˆ¶
- `backend/data/Sense_A_Finetuned_enhanced.jsonl`: å¢å¼ºçš„èŠ‚ç‚¹æ•°æ®

### å…³é”®å‡½æ•°
- `_enhanced_fusion()`: å¢å¼ºèåˆå‡½æ•°ï¼Œæ·»åŠ åè¯æƒ©ç½š
- `apply_negatives()`: åè¯æƒ©ç½šè®¡ç®—å‡½æ•°

### é…ç½®å‚æ•°
- `penalty`: 0.15 (åè¯æƒ©ç½šç³»æ•°)
- `alpha`: 0.35 (ç»“æ„é€šé“æƒé‡)
- `beta`: 0.65 (ç»†èŠ‚é€šé“æƒé‡)

## ğŸš€ ä¸‹ä¸€æ­¥

1. **ä½¿ç”¨å¢å¼ºæ•°æ®**: å°† `Sense_A_Finetuned_enhanced.jsonl` æ›¿æ¢åŸå§‹æ•°æ®
2. **é‡æ–°æµ‹è¯•ç³»ç»Ÿ**: éªŒè¯åè¯æƒ©ç½šå’Œå¢å¼ºåˆ¤åˆ«è¯çš„æ•ˆæœ
3. **è§‚å¯Ÿç»“æ„é€šé“**: ç¡®è®¤0.488/0.488æ‰“å¹³æƒ…å†µå‡å°‘
4. **æ£€æŸ¥marginæå‡**: ç¡®è®¤ä»0.000æå‡åˆ°0.350+
5. **é•¿æœŸç›‘æ§**: è§‚å¯Ÿ"å…¨æ˜¯ch"é—®é¢˜æ˜¯å¦å¾—åˆ°æ ¹æœ¬æ”¹å–„

## ğŸ“‹ æ•°æ®æ–‡ä»¶æ›´æ–°

### åŸå§‹æ–‡ä»¶
- `Sense_A_Finetuned.fixed.jsonl` (åŸå§‹ç‰ˆæœ¬)

### å¢å¼ºæ–‡ä»¶  
- `Sense_A_Finetuned_enhanced.jsonl` (å¢å¼ºç‰ˆæœ¬ï¼ŒåŒ…å«åˆ¤åˆ«è¯å’Œåè¯æç¤º)

### å»ºè®®æ“ä½œ
å°†å¢å¼ºç‰ˆæœ¬é‡å‘½åä¸ºåŸå§‹æ–‡ä»¶åï¼Œæˆ–ä¿®æ”¹ä»£ç æŒ‡å‘å¢å¼ºç‰ˆæœ¬ã€‚
